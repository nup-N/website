# 添加管理员用户说明

## 方法1：通过数据库直接设置（推荐，最简单）

### 步骤：

1. **连接到数据库**
   ```bash
   # 如果使用 MySQL
   mysql -u root -p -h localhost -P 5432 navigation
   
   # 如果使用 PostgreSQL
   psql -U postgres -d navigation
   ```

2. **执行 SQL 语句**
   ```sql
   -- 将指定用户名的用户设置为 admin
   UPDATE users 
   SET role = 'admin' 
   WHERE username = 'testuser';
   
   -- 或者设置为 super_admin
   UPDATE users 
   SET role = 'super_admin' 
   WHERE username = 'testuser';
   ```

3. **验证**
   ```sql
   SELECT id, username, email, role 
   FROM users 
   WHERE username = 'testuser';
   ```

### 优点：
- ✅ 最简单直接
- ✅ 不需要任何认证
- ✅ 适合首次设置管理员

---

## 方法2：通过 API 接口（需要已有管理员账号）

### 前提条件：
- 必须已经有一个管理员账号（可以通过方法1先设置一个）

### 步骤：

1. **使用脚本工具**
   ```bash
   cd website/backend
   node set-admin.js <admin_username> <admin_password> <target_username> [role]
   ```

2. **示例**
   ```bash
   # 将 testuser 设置为 admin
   node set-admin.js admin 123456 testuser admin
   
   # 将 testuser 设置为 super_admin
   node set-admin.js admin 123456 testuser super_admin
   ```

### 优点：
- ✅ 不需要直接操作数据库
- ✅ 可以通过 API 管理
- ✅ 适合已有管理员的情况

---

## 方法3：通过 curl 命令

### 前提条件：
- 必须已经有一个管理员账号
- 需要先登录获取 token

### 步骤：

1. **登录获取 token**
   ```bash
   curl -X POST http://localhost:3000/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{
       "username": "admin",
       "password": "123456"
     }'
   ```

2. **更新用户角色**
   ```bash
   curl -X PATCH http://localhost:3000/api/users/<user_id> \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer <your_token>" \
     -d '{
       "role": "admin"
     }'
   ```

---

## 方法4：通过 Postman 或其他 API 工具

1. **登录获取 token**
   - URL: `POST http://localhost:3000/api/auth/login`
   - Body:
     ```json
     {
       "username": "admin",
       "password": "123456"
     }
     ```

2. **更新用户角色**
   - URL: `PATCH http://localhost:3000/api/users/<user_id>`
   - Headers:
     - `Content-Type: application/json`
     - `Authorization: Bearer <your_token>`
   - Body:
     ```json
     {
       "role": "admin"
     }
     ```

---

## 角色说明

- **guest**: 访客（最低权限）
- **user**: 普通用户（默认角色）
- **premium**: 高级用户
- **admin**: 管理员（可以管理所有网站和分类）
- **super_admin**: 超级管理员（最高权限）

---

## 首次设置管理员

如果是首次设置管理员，推荐使用方法1（直接操作数据库）：

```sql
-- 1. 先注册一个普通用户（通过前端或注册接口）
-- 2. 然后执行以下 SQL 将其提升为管理员
UPDATE users 
SET role = 'admin' 
WHERE username = 'your_username';
```

---

## 常见问题

### Q: 如何查看所有用户及其角色？
```sql
SELECT id, username, email, role, created_at 
FROM users 
ORDER BY id;
```

### Q: 如何查看指定用户的角色？
```sql
SELECT id, username, email, role 
FROM users 
WHERE username = 'testuser';
```

### Q: 如何批量设置多个用户为管理员？
```sql
UPDATE users 
SET role = 'admin' 
WHERE username IN ('user1', 'user2', 'user3');
```

### Q: 如何撤销管理员权限？
```sql
UPDATE users 
SET role = 'user' 
WHERE username = 'testuser';
```

